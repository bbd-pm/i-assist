<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field2Lab - Mobile App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function Field2LabApp() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [showLogin, setShowLogin] = useState(true);
            const [currentScreen, setCurrentScreen] = useState("dashboard");
            const [showMenu, setShowMenu] = useState(false);
            const [experiments, setExperiments] = useState([]);
            
            const [formData, setFormData] = useState({
                name: "", email: "", password: "", phone: "", organization: ""
            });
            
            const [experimentName, setExperimentName] = useState("");
            const [location, setLocation] = useState(null);
            const [currentExperimentId, setCurrentExperimentId] = useState(null);
            
            const [environmentData, setEnvironmentData] = useState({
                temperature: "28.5", humidity: "65.2", timestamp: new Date().toLocaleTimeString()
            });

            const [replicateData, setReplicateData] = useState({
                R1: { height: "", thickness: "", greenness: "", image: null },
                R2: { height: "", thickness: "", greenness: "", image: null },
                R3: { height: "", thickness: "", greenness: "", image: null }
            });

            const [isCapturing, setIsCapturing] = useState(false);

            useEffect(() => {
                if (isAuthenticated) {
                    const interval = setInterval(() => {
                        setEnvironmentData({
                            temperature: (20 + Math.random() * 15).toFixed(1),
                            humidity: (40 + Math.random() * 40).toFixed(1),
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }, 30000);
                    return () => clearInterval(interval);
                }
            }, [isAuthenticated]);

            const handleRegister = (e) => {
                e.preventDefault();
                if (!formData.name || !formData.email || !formData.password) {
                    alert("Please fill all required fields");
                    return;
                }
                setCurrentUser({ id: Date.now(), name: formData.name, email: formData.email, role: "member" });
                setIsAuthenticated(true);
                setCurrentScreen("dashboard");
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if (!formData.email || !formData.password) {
                    alert("Please enter email and password");
                    return;
                }
                setCurrentUser({ id: Date.now(), name: "Demo User", email: formData.email, role: "member" });
                setIsAuthenticated(true);
                setCurrentScreen("dashboard");
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                setCurrentUser(null);
                setCurrentScreen("dashboard");
                setShowLogin(true);
                setExperiments([]);
            };

            const createNewExperiment = () => {
                const newExp = {
                    id: Date.now(),
                    name: "",
                    userId: currentUser.id,
                    createdAt: new Date().toISOString(),
                    status: "in_progress"
                };
                setCurrentExperimentId(newExp.id);
                setExperiments([...experiments, newExp]);
                setCurrentScreen("experiment-creation");
            };

            const handleGeotag = () => {
                const lat = 28.6139 + (Math.random() - 0.5) * 0.1;
                const lng = 77.2090 + (Math.random() - 0.5) * 0.1;
                setLocation({ lat, lng });
            };

            const handleCaptureImage = async (replicate) => {
                setIsCapturing(true);
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const height = (80 + Math.random() * 50).toFixed(0);
                const thickness = (10 + Math.random() * 10).toFixed(1);
                
                setReplicateData(prev => ({
                    ...prev,
                    [replicate]: { ...prev[replicate], height, thickness, image: `img_${replicate}.png` }
                }));
                setIsCapturing(false);
            };

            const saveReplicateOutput = (replicate) => {
                if (!replicateData[replicate].image) {
                    alert("Please capture plant image first");
                    return;
                }
                
                if (replicate === "R1") setCurrentScreen("r2-input");
                else if (replicate === "R2") setCurrentScreen("r3-input");
                else {
                    const updated = experiments.map(exp => 
                        exp.id === currentExperimentId ? { ...exp, status: "completed" } : exp
                    );
                    setExperiments(updated);
                    setCurrentScreen("comparison");
                }
            };

            const calculateAverage = (field) => {
                const values = ["R1", "R2", "R3"]
                    .map(r => parseFloat(replicateData[r][field]))
                    .filter(v => !isNaN(v));
                return values.length ? (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1) : "-";
            };

            const MobileHeader = ({ title }) => (
                <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-4 flex items-center justify-between shadow-lg">
                    <button onClick={() => setShowMenu(!showMenu)} className="p-2">‚ò∞</button>
                    <h1 className="text-lg font-bold flex-1 text-center">{title}</h1>
                    <div className="w-8"></div>
                </div>
            );

            const SideMenu = () => (
                <div className={`fixed inset-0 bg-black bg-opacity-50 z-50 ${showMenu ? '' : 'hidden'}`} onClick={() => setShowMenu(false)}>
                    <div className={`fixed left-0 top-0 bottom-0 w-80 bg-white shadow-2xl`} onClick={(e) => e.stopPropagation()}>
                        <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-6">
                            <div className="w-12 h-12 bg-white rounded-full flex items-center justify-center mb-2">
                                <span className="text-green-600 text-2xl">üë§</span>
                            </div>
                            <p className="font-bold text-lg">{currentUser?.name}</p>
                            <p className="text-sm text-green-100">{currentUser?.email}</p>
                        </div>
                        <div className="p-4">
                            <button onClick={() => { setCurrentScreen("dashboard"); setShowMenu(false); }} className="w-full text-left p-3 rounded-lg hover:bg-gray-100 mb-2 font-medium">üè† Dashboard</button>
                            <button onClick={() => { setCurrentScreen("my-experiments"); setShowMenu(false); }} className="w-full text-left p-3 rounded-lg hover:bg-gray-100 mb-2 font-medium">üìã My Experiments</button>
                            <button onClick={() => { setCurrentScreen("profile"); setShowMenu(false); }} className="w-full text-left p-3 rounded-lg hover:bg-gray-100 mb-2 font-medium">‚öôÔ∏è Profile</button>
                            <div className="border-t my-4"></div>
                            <button onClick={handleLogout} className="w-full text-left p-3 rounded-lg hover:bg-red-50 text-red-600 font-medium">üö™ Logout</button>
                        </div>
                    </div>
                </div>
            );

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center p-4">
                        <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
                            <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-8 text-center">
                                <h1 className="text-3xl font-bold mb-2">üåæ Field2Lab</h1>
                                <p className="text-green-100">Data Recording System</p>
                            </div>
                            
                            <div className="flex border-b">
                                <button onClick={() => setShowLogin(true)} className={`flex-1 py-3 font-semibold ${showLogin ? 'border-b-2 border-green-600 text-green-600' : 'text-gray-500'}`}>Login</button>
                                <button onClick={() => setShowLogin(false)} className={`flex-1 py-3 font-semibold ${!showLogin ? 'border-b-2 border-green-600 text-green-600' : 'text-gray-500'}`}>Register</button>
                            </div>
                            
                            <form onSubmit={showLogin ? handleLogin : handleRegister} className="p-6 space-y-4">
                                {!showLogin && (
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Full Name *</label>
                                        <input type="text" className="w-full p-3 border-2 rounded-lg" placeholder="John Doe" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} required={!showLogin} />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Email *</label>
                                    <input type="email" className="w-full p-3 border-2 rounded-lg" placeholder="john@example.com" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} required />
                                </div>
                                {!showLogin && (
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Phone</label>
                                        <input type="tel" className="w-full p-3 border-2 rounded-lg" placeholder="+91 98765 43210" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Password *</label>
                                    <input type="password" className="w-full p-3 border-2 rounded-lg" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={formData.password} onChange={(e) => setFormData({...formData, password: e.target.value})} required />
                                </div>
                                {!showLogin && (
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Organization</label>
                                        <input type="text" className="w-full p-3 border-2 rounded-lg" placeholder="Your Organization" value={formData.organization} onChange={(e) => setFormData({...formData, organization: e.target.value})} />
                                    </div>
                                )}
                                <button type="submit" className="w-full py-4 bg-gradient-to-r from-green-600 to-green-700 text-white font-bold rounded-lg shadow-lg text-lg">
                                    {showLogin ? "Login" : "Register as Member"}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            if (currentScreen === "dashboard") {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <MobileHeader title="Dashboard" />
                        <SideMenu />
                        <div className="p-4 space-y-4">
                            <div className="bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl p-6">
                                <h2 className="text-2xl font-bold mb-2">Welcome, {currentUser?.name}!</h2>
                                <p className="text-green-100">Role: {currentUser?.role?.toUpperCase()}</p>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-white p-6 rounded-xl shadow-md text-center">
                                    <div className="text-4xl font-bold text-green-600">{experiments.length}</div>
                                    <div className="text-gray-600 mt-2">Total</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-md text-center">
                                    <div className="text-4xl font-bold text-blue-600">{experiments.filter(e => e.status === "completed").length}</div>
                                    <div className="text-gray-600 mt-2">Completed</div>
                                </div>
                            </div>
                            <button onClick={createNewExperiment} className="w-full py-4 bg-gradient-to-r from-green-600 to-green-700 text-white font-bold rounded-xl shadow-lg text-lg">
                                + Create New Experiment
                            </button>
                            <div className="bg-white rounded-xl shadow-md p-4">
                                <h3 className="font-bold text-lg mb-3">Recent Experiments</h3>
                                {experiments.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">No experiments yet</p>
                                ) : (
                                    experiments.slice(-3).reverse().map(exp => (
                                        <div key={exp.id} className="border-b py-3">
                                            <div className="flex justify-between">
                                                <p className="font-semibold">{exp.name || "Untitled"}</p>
                                                <span className={`px-2 py-1 rounded text-xs ${exp.status === "completed" ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700"}`}>
                                                    {exp.status}
                                                </span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (currentScreen === "experiment-creation") {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <MobileHeader title="Create Experiment" />
                        <SideMenu />
                        <div className="p-4 space-y-4 pb-24">
                            <div className="bg-white rounded-xl p-4">
                                <label className="block font-semibold mb-2">Experiment Name *</label>
                                <input className="w-full p-3 border-2 rounded-lg" placeholder="Neem vs Urea Trial" value={experimentName} onChange={(e) => setExperimentName(e.target.value)} />
                            </div>
                            <div className="bg-white rounded-xl p-4">
                                <label className="block font-semibold mb-3">Location *</label>
                                <button onClick={handleGeotag} className="w-full py-3 bg-yellow-500 text-black font-semibold rounded-lg">
                                    üìç {location ? "Update Location" : "Geo-Tag Plot"}
                                </button>
                                {location && <p className="mt-2 text-green-700 text-sm">‚úì {location.lat.toFixed(5)}, {location.lng.toFixed(5)}</p>}
                            </div>
                        </div>
                        <div className="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg">
                            <button onClick={() => { if (experimentName && location) setCurrentScreen("r1-input"); else alert("Fill all fields"); }} className="w-full py-4 bg-green-600 text-white font-bold rounded-lg">
                                Next: R1 Input ‚Üí
                            </button>
                        </div>
                    </div>
                );
            }

            if (currentScreen.endsWith("-input")) {
                const rep = currentScreen.split("-")[0].toUpperCase();
                return (
                    <div className="min-h-screen bg-gray-50">
                        <MobileHeader title={`${rep} - Input`} />
                        <SideMenu />
                        <div className="p-4 space-y-4 pb-24">
                            <div className="bg-white rounded-xl p-4">
                                <h3 className="font-semibold mb-3">üå°Ô∏è Environmental Data</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-red-50 p-3 rounded-lg">
                                        <p className="text-xs text-gray-600">Temperature</p>
                                        <p className="text-xl font-bold">{environmentData.temperature}¬∞C</p>
                                    </div>
                                    <div className="bg-blue-50 p-3 rounded-lg">
                                        <p className="text-xs text-gray-600">Humidity</p>
                                        <p className="text-xl font-bold">{environmentData.humidity}%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg">
                            <button onClick={() => setCurrentScreen(`${rep.toLowerCase()}-output`)} className="w-full py-4 bg-blue-600 text-white font-bold rounded-lg">
                                Next: {rep} Output ‚Üí
                            </button>
                        </div>
                    </div>
                );
            }

            if (currentScreen.endsWith("-output")) {
                const rep = currentScreen.split("-")[0].toUpperCase();
                return (
                    <div className="min-h-screen bg-gray-50">
                        <MobileHeader title={`${rep} - Output`} />
                        <SideMenu />
                        <div className="p-4 space-y-4 pb-24">
                            <div className="bg-white rounded-xl p-4">
                                <button onClick={() => handleCaptureImage(rep)} disabled={isCapturing} className="w-full py-4 bg-green-600 text-white font-bold rounded-lg">
                                    üì∏ {isCapturing ? "Processing..." : "Capture Image"}
                                </button>
                                {replicateData[rep].image && <p className="mt-2 text-green-700 text-sm">‚úì Image captured</p>}
                            </div>
                            <div className="bg-white rounded-xl p-4 space-y-3">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Height (cm)</label>
                                    <input type="number" className="w-full p-3 border-2 rounded-lg bg-green-50" value={replicateData[rep].height} onChange={(e) => setReplicateData(p => ({...p, [rep]: {...p[rep], height: e.target.value}}))} />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">Thickness (mm)</label>
                                    <input type="number" className="w-full p-3 border-2 rounded-lg bg-green-50" value={replicateData[rep].thickness} onChange={(e) => setReplicateData(p => ({...p, [rep]: {...p[rep], thickness: e.target.value}}))} />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">Greenness (0-100)</label>
                                    <input type="number" className="w-full p-3 border-2 rounded-lg" value={replicateData[rep].greenness} onChange={(e) => setReplicateData(p => ({...p, [rep]: {...p[rep], greenness: e.target.value}}))} />
                                </div>
                            </div>
                        </div>
                        <div className="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg">
                            <button onClick={() => saveReplicateOutput(rep)} className="w-full py-4 bg-green-600 text-white font-bold rounded-lg">
                                {rep === "R3" ? "View Results" : `Next: ${rep === "R1" ? "R2" : "R3"}`} ‚Üí
                            </button>
                        </div>
                    </div>
                );
            }

            if (currentScreen === "comparison") {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <MobileHeader title="Results" />
                        <SideMenu />
                        <div className="p-4 space-y-4">
                            <div className="bg-white rounded-xl overflow-hidden">
                                <table className="w-full text-sm">
                                    <thead className="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
                                        <tr>
                                            <th className="p-3 text-left">Param</th>
                                            <th className="p-2">R1</th>
                                            <th className="p-2">R2</th>
                                            <th className="p-2">R3</th>
                                            <th className="p-2 bg-yellow-500 text-black">Avg</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr className="border-b">
                                            <td className="p-3 font-semibold">Height</td>
                                            <td className="p-2 text-center">{replicateData.R1.height || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R2.height || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R3.height || "-"}</td>
                                            <td className="p-2 text-center bg-yellow-50 font-bold">{calculateAverage("height")}</td>
                                        </tr>
                                        <tr className="border-b">
                                            <td className="p-3 font-semibold">Thickness</td>
                                            <td className="p-2 text-center">{replicateData.R1.thickness || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R2.thickness || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R3.thickness || "-"}</td>
                                            <td className="p-2 text-center bg-yellow-50 font-bold">{calculateAverage("thickness")}</td>
                                        </tr>
                                        <tr>
                                            <td className="p-3 font-semibold">Greenness</td>
                                            <td className="p-2 text-center">{replicateData.R1.greenness || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R2.greenness || "-"}</td>
                                            <td className="p-2 text-center">{replicateData.R3.greenness || "-"}</td>
                                            <td className="p-2 text-center bg-yellow-50 font-bold">{calculateAverage("greenness")}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <button onClick={() => setCurrentScreen("dashboard")} className="w-full py-3 bg-green-600 text-white font-semibold rounded-lg">
                                ‚úì Back to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.render(<Field2LabApp />, document.getElementById('root'));
    </script>
</body>
</html>